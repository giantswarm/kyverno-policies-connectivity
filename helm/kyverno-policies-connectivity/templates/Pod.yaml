# THIS FILE IS GENERATED WITH 'make generate' - DO NOT EDIT MANUALLY
{{- if .Values.proxy.enabled }}
{{- $proxy := deepCopy .Values.cluster.proxy |  mustMerge .Values.proxy -}}
apiVersion: kyverno.io/v1
kind: ClusterPolicy
metadata:
  name: inject-proxy-env
spec:
  rules:
    - name: inject-proxy-env-to-containers
      match:
        resources:
          kinds:
            - Pod
{{- if $proxy.namespaces }}
          namespaces:
          {{- range $proxy.namespaces }}
            - {{ . | quote }}
          {{- end }}
{{- end }}
      mutate:
        patchStrategicMerge:
          spec:
            containers:
              - (name): "*"
                env:
                  {{- if $proxy.http }}
                  - name: HTTP_PROXY
                    value: {{ $proxy.http }}
                  - name: http_proxy
                    value: {{ $proxy.http }}
                  {{- end }}
                  {{- if $proxy.https }}
                  - name: HTTPS_PROXY
                    value: {{ $proxy.https }}
                  - name: https_proxy
                    value: {{ $proxy.https }}
                  {{- end }}
                  {{- if $proxy.noProxy }}
                  - name: NO_PROXY
                    value: {{ join "," $proxy.noProxy }}
                  - name: no_proxy
                    value: {{ join "," $proxy.noProxy }}
                  {{- end }}
            =(initContainers):
              - (name): "*"
                env:
                  {{- if $proxy.http }}
                  - name: HTTP_PROXY
                    value: {{ $proxy.http }}
                  - name: http_proxy
                    value: {{ $proxy.http }}
                  {{- end }}
                  {{- if $proxy.https }}
                  - name: HTTPS_PROXY
                    value: {{ $proxy.https }}
                  - name: https_proxy
                    value: {{ $proxy.https }}
                  {{- end }}
                  {{- if $proxy.noProxy }}
                  - name: NO_PROXY
                    value: {{ join "," $proxy.noProxy }}
                  - name: no_proxy
                    value: {{ join "," $proxy.noProxy }}
                  {{- end }}
            =(ephemeralContainers):
              - (name): "*"
                env:
                  {{- if $proxy.HTTP }}
                  - name: HTTP_PROXY
                    value: {{ $proxy.http }}
                  - name: http_proxy
                    value: {{ $proxy.http }}
                  {{- end }}
                  {{- if $proxy.https }}
                  - name: HTTPS_PROXY
                    value: {{ $proxy.https }}
                  - name: https_proxy
                    value: {{ $proxy.https }}
                  {{- end }}
                  {{- if $proxy.noProxy }}
                  - name: NO_PROXY
                    value: {{ join "," $proxy.noProxy }}
                  - name: no_proxy
                    value: {{ join "," $proxy.noProxy }}
                  {{- end }}
{{- end }}
